
CREATE OR REPLACE TABLE CUSTOMERS 
(
    ID INT AUTOINCREMENT START = 1 INCREMENT = 1,
    DATE DATE
);
CREATE OR REPLACE TASK CUSTOMER_INSERT
    WAREHOUSE = MRCSBWH
    SCHEDULE = '1 MINUTE'
    AS 
    INSERT INTO CUSTOMERS(DATE) VALUES(CURRENT_TIMESTAMP);
  
ALTER TASK CUSTOMER_INSERT RESUME;
ALTER TASK CUSTOMER_INSERT SUSPEND;
  
SELECT * FROM CUSTOMERS;
  

SHOW TASKS;
CREATE OR REPLACE TASK CUSTOMER_INSERT
    WAREHOUSE = COMPUTE_WH
    SCHEDULE = 'USING CRON 0 7,10 * * 5L UTC'
    AS 
    INSERT INTO CUSTOMERS(CREATE_DATE) VALUES(CURRENT_TIMESTAMP);
    

//USING CRON * * * * * 
# __________ minute (0-59)
# | ________ hour (0-23)
# | | ______ day of month (1-31, or L)
# | | | ____ month (1-12, JAN-DEC)
# | | | | __ day of week (0-6, SUN-SAT, or L)
# | | | | |
# | | | | |
# * * * * *




// Every minute
SCHEDULE = 'USING CRON * * * * * UTC';


// Every day at 6am UTC timezone
SCHEDULE = 'USING CRON 0 6 * * * UTC';

// Every hour starting at 9 AM and ending at 5 PM on Sundays 
SCHEDULE = 'USING CRON 0 9-17 * * SUN America/Los_Angeles';


CREATE OR REPLACE TASK CUSTOMER_INSERT
    WAREHOUSE = COMPUTE_WH
    SCHEDULE = 'USING CRON 0 9,17 * * * UTC'
    AS 
    INSERT INTO CUSTOMERS(CREATE_DATE) VALUES(CURRENT_TIMESTAMP);
  
  
  
//TASK TREE

SELECT * FROM CUSTOMERS;

// Prepare a second table
CREATE OR REPLACE TABLE CUSTOMERS2 (
    CUSTOMER_ID INT,
    CREATE_DATE DATE);
    
    
// Suspend parent task
// **NOTE: Before modifying anything in the tree of tasks the root task needs to be suspended**

ALTER TASK CUSTOMER_INSERT SUSPEND;
    
// Create a child task
CREATE OR REPLACE TASK CUSTOMER_INSERT2
    WAREHOUSE = MRCSBWH
    AFTER CUSTOMER_INSERT
    AS 
    INSERT INTO CUSTOMERS2 SELECT * FROM CUSTOMERS;
    
    


SHOW TASKS;

// Resume tasks (first resume child tasks)
ALTER TASK CUSTOMER_INSERT2 RESUME;

// Resume tasks (then resume root task)
ALTER TASK CUSTOMER_INSERT RESUME;

// Recursively resumes a specified task and all its dependent tasks
SELECT SYSTEM$TASK_DEPENDENTS_ENABLE( 'CUSTOMER_INSERT' );


SELECT * FROM CUSTOMERS2;



// Suspend tasks again
ALTER TASK CUSTOMER_INSERT SUSPEND;
ALTER TASK CUSTOMER_INSERT2 SUSPEND;








CREATE OR REPLACE TABLE TASKSS2 
(
    ID INT AUTOINCREMENT START = 1 INCREMENT = 1,
    DATE DATE
);

CREATE OR REPLACE TASK SAMPLE_TASK
    WAREHOUSE = SMWH
    SCHEDULE = '1 MINUTE'
    AS
    INSERT INTO TASKSS(DATE) VALUES(CURRENT_TIMESTAMP);

ALTER TASK SAMPLE_TASK RESUME;
SELECT * FROM TASKSS;


CREATE OR REPLACE TASK SAMPLE_TASK2 
    WAREHOUSE = SMWH
    AFTER SAMPLE_TASK
    AS
    INSERT INTO TASKSS2 SELECT * FROM TASKSS;

ALTER TASK SAMPLE_TASK2 SUSPEND;


SELECT * FROM TASKSS2;


SELECT * FROM TASKSS;

SELECT * FROM TASKSS BEFORE (STATEMENT => '01bac134-0000-e398-0000-0008e02a6285') ;

